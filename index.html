<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO 元標籤 -->
    <title>咖啡風味探索器 - 找到最適合你口味的咖啡豆</title>
    <meta name="description" content="使用咖啡風味探索器根據您的口味偏好，在數十種精選咖啡豆中找到完美匹配。探索來自非洲、美洲和亞洲的頂級咖啡產區。">
    <meta name="keywords" content="咖啡豆, 咖啡風味, 手沖咖啡, 精品咖啡, 咖啡推薦, 衣索比亞咖啡, 哥倫比亞咖啡, 咖啡產地, 咖啡處理法, 咖啡對比">
    
    <!-- 開放圖譜協議標籤 (社交媒體分享) -->
    <meta property="og:title" content="咖啡風味探索器 - 找到最適合你口味的咖啡豆">
    <meta property="og:description" content="根據您的風味喜好，發現完美匹配的咖啡豆。從輕盈明亮的衣索比亞到醇厚濃郁的印尼，探索全球咖啡風味。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://coffeematcher.me">
    <meta property="og:image" content="https://coffeematcher.me/coffee-explorer-preview.jpeg">
    
    <!-- 標準圖標 -->
    <link rel="icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <!-- 結構化數據標記 (Schema.org) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "咖啡風味探索器",
        "description": "一個幫助咖啡愛好者根據個人口味偏好找到完美咖啡豆的互動工具。",
        "applicationCategory": "FoodAndDrink",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "HKD"
        }
    }
    </script>
    
    <!-- 規範連結 (用於多語言版本) -->
    <link rel="alternate" hreflang="zh-HK" href="https://coffeematcher.me/">
    <link rel="alternate" hreflang="en" href="https://coffeematcher.me/en/">
    <link rel="canonical" href="https://coffeematcher.me/">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #795548;
            --primary-light: #a98274;
            --primary-dark: #4b2c20;
            --accent: #ff9800;
            --background: #f5efe0;
            --card-bg: #ffffff;
            --text: #5d4037;
            --text-light: #8d6e63;
            --shadow: rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Noto Sans TC', 'Noto Sans', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(121, 85, 72, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 90% 30%, rgba(255, 152, 0, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 30% 70%, rgba(121, 85, 72, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 80% 80%, rgba(255, 152, 0, 0.03) 0%, transparent 20%);
        }
        
        .coffee-beans {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .coffee-bean {
            position: absolute;
            background-color: rgba(121, 85, 72, 0.05);
            border-radius: 50%;
            filter: blur(1px);
            transform: rotate(var(--rotation));
        }
        
        .language-switcher {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 14px;
            z-index: 100;
        }

        .language-switcher a {
            text-decoration: none;
            color: var(--text-light);
            padding: 5px;
            transition: color 0.3s;
        }

        .language-switcher a:hover {
            color: var(--accent);
        }

        .language-switcher a.active {
            color: var(--primary);
            font-weight: bold;
        }
        
        header {
            text-align: center;
            padding: 20px 0 30px;
            position: relative;
        }
        
        h1 {
            margin: 0;
            color: var(--primary-dark);
            font-size: 2.5rem;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            width: 70%;
            height: 3px;
            background-color: var(--accent);
            bottom: -8px;
            left: 15%;
            border-radius: 3px;
            animation: underlineGrow 1.5s ease-out forwards;
            transform-origin: center;
            transform: scaleX(0);
        }
        
        @keyframes underlineGrow {
            to { transform: scaleX(1); }
        }
        
        .mode-toggle {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .toggle-container {
            display: inline-flex;
            background-color: #e0e0e0;
            border-radius: 30px;
            padding: 5px;
            position: relative;
            margin: 0 auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .toggle-btn {
            background: none;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            position: relative;
            z-index: 2;
            transition: color 0.3s ease;
            color: var(--text);
            white-space: nowrap;
        }
        
        .toggle-btn:hover {
            color: var(--primary-dark);
        }
        
        .toggle-btn.active {
            color: white;
        }
        
        .selector {
            position: absolute;
            height: calc(100% - 10px);
            border-radius: 25px;
            top: 5px;
            left: 5px;
            background-color: var(--primary);
            transition: transform 0.3s ease, width 0.3s ease;
            z-index: 1;
        }
        
        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .flavor-selector {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px var(--shadow);
            flex: 1;
            min-width: 300px;
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 0.6s forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .flavor-selector h2 {
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .slider-container {
            margin: 20px 0;
            position: relative;
        }
        
        label {
            display: inline-block;
            width: 100px;
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            width: calc(100% - 150px);
            height: 6px;
            background: #e0e0e0;
            border-radius: 5px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: transform 0.2s, background 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: var(--primary-dark);
        }
        
        .value-display {
            display: inline-block;
            width: 30px;
            text-align: center;
            font-weight: 500;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            padding: 3px;
            margin-left: 10px;
            transition: transform 0.2s, background-color 0.2s;
        }
        
        .slider-container:hover .value-display {
            background-color: var(--primary-dark);
            transform: scale(1.1);
        }
        
        .filter-options {
            margin: 20px 0;
        }
        
        .filter-options h3 {
            color: var(--primary-dark);
            font-size: 1.1rem;
            margin-bottom: 12px;
        }
        
        .region-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .region-btn {
            background-color: #e0e0e0;
            color: var(--text);
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .region-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .region-btn.active {
            background-color: var(--primary);
            color: white;
        }
        
        .controls-row {
            display: flex;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .results-count {
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
            white-space: nowrap;
        }
        
        #num-results {
            width: 50px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            text-align: center;
            margin: 0 10px;
        }
        
        .search-button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin-left: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-button:hover {
            background-color: #f57c00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .search-button:active {
            transform: translateY(0);
        }
        
        .search-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            margin-right: 8px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        #results {
            display: none;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px var(--shadow);
            flex: 1;
            min-width: 300px;
            transition: opacity 0.5s, transform 0.5s;
            opacity: 0;
            transform: translateY(20px);
        }
        
        #results.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .coffee-bean-card {
            margin: 25px 0;
            padding: 20px;
            border-radius: 12px;
            background-color: #efebe9;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
        }
        
        .coffee-bean-card.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .coffee-bean-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .coffee-bean-card h3 {
            margin-top: 0;
            color: var(--primary-dark);
            font-size: 1.3rem;
            border-bottom: 1px solid rgba(0,0,0,0.07);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .flavor-profile {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .flavor-tag {
            background-color: rgba(169, 130, 116, 0.15);
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 14px;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        
        .flavor-tag:hover {
            background-color: rgba(169, 130, 116, 0.3);
            transform: translateY(-2px);
        }
        
        .simple-view {
            margin-top: 15px;
        }
        
        .origin-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            background-color: var(--primary-light);
            color: white;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .simple-flavor {
            margin: 15px 0;
            background-color: #fff;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .flavor-bar-container {
            display: flex;
            margin: 8px 0;
            align-items: center;
        }
        
        .flavor-name {
            width: 80px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .flavor-bar {
            flex-grow: 1;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .flavor-fill {
            height: 100%;
            background-color: var(--primary);
            border-radius: 4px;
            width: 0;
            transition: width 1s cubic-bezier(0.45, 0.05, 0.55, 0.95);
        }
        
        .brewing-tips {
            margin-top: 15px;
            background-color: rgba(255, 152, 0, 0.1);
            border-left: 3px solid var(--accent);
            padding: 10px 15px;
            border-radius: 0 8px 8px 0;
        }
        
        .data-source {
            margin-top: 20px;
            font-size: 14px;
            color: var(--text-light);
            text-align: center;
            font-style: italic;
        }
        
        .professional-mode {
            display: none;
        }
        
        .professional-details {
            background-color: rgba(233, 226, 219, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .professional-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 8px;
        }
        
        .professional-item {
            flex: 1;
            min-width: 150px;
        }
        
        .processing-tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            background-color: var(--primary);
            color: white;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 152, 0, 0.2);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s infinite linear;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 15px;
            color: var(--text);
        }
        
        .error-message {
            color: #c62828;
            text-align: center;
            font-weight: bold;
            padding: 15px;
            background-color: rgba(198, 40, 40, 0.1);
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .roast-selector {
            margin: 15px 0;
        }
        
        .roast-levels {
            display: flex;
            background-color: #e0e0e0;
            border-radius: 30px;
            padding: 5px;
            position: relative;
            margin-top: 10px;
        }
        
        .roast-btn {
            flex: 1;
            text-align: center;
            background: none;
            border: none;
            padding: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            position: relative;
            z-index: 2;
            transition: color 0.3s;
            color: var(--text);
        }
        
        .roast-btn.active {
            color: white;
        }
        
        .roast-selector-highlight {
            position: absolute;
            height: calc(100% - 10px);
            border-radius: 25px;
            top: 5px;
            left: 5px;
            background-color: var(--primary);
            transition: transform 0.3s, width 0.3s;
            z-index: 1;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .controls-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .search-button {
                margin-left: 0;
                width: 100%;
            }
            
            input[type="range"] {
                width: calc(100% - 50px);
            }
            
            label {
                width: auto;
                margin-bottom: 5px;
            }
            
            .slider-container {
                display: flex;
                flex-wrap: wrap;
            }
            
            .language-switcher {
                position: relative;
                text-align: right;
                top: 0;
                right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="coffee-beans" id="coffee-beans-bg"></div>
    
    <div class="language-switcher">
        <a href="#" class="active" data-lang="zh" data-i18n="lang-zh">中文</a> | 
        <a href="#" data-lang="en" data-i18n="lang-en">English</a>
    </div>
    
    <header>
        <h1 data-i18n="title">咖啡風味探索器</h1>
    </header>
    
    <div class="mode-toggle">
        <div class="toggle-container">
            <button id="simple-mode-btn" class="toggle-btn active" data-i18n="simple-mode">簡易模式</button>
            <button id="professional-mode-btn" class="toggle-btn" data-i18n="professional-mode">專業模式</button>
            <span class="selector"></span>
        </div>
    </div>
    
    <div class="main-container">
        <div class="flavor-selector">
            <h2 data-i18n="flavor-preference-title">調整你喜好的咖啡風味</h2>
            <p data-i18n="slider-instructions">拖動滑桿以設定你理想的咖啡特性：</p>
            
            <div class="slider-container">
                <label for="acidity" data-i18n="acidity">酸度：</label>
                <input type="range" id="acidity" min="1" max="10" value="5">
                <span id="acidity-value" class="value-display">5</span>
            </div>
            
            <div class="slider-container">
                <label for="body" data-i18n="body">厚度：</label>
                <input type="range" id="body" min="1" max="10" value="5">
                <span id="body-value" class="value-display">5</span>
            </div>
            
            <div class="slider-container">
                <label for="sweetness" data-i18n="sweetness">甜度：</label>
                <input type="range" id="sweetness" min="1" max="10" value="5">
                <span id="sweetness-value" class="value-display">5</span>
            </div>
            
            <div class="slider-container">
                <label for="bitterness" data-i18n="bitterness">苦度：</label>
                <input type="range" id="bitterness" min="1" max="10" value="5">
                <span id="bitterness-value" class="value-display">5</span>
            </div>
            
            <div class="professional-mode slider-container">
                <label for="fruity" data-i18n="fruity">果香：</label>
                <input type="range" id="fruity" min="1" max="10" value="5">
                <span id="fruity-value" class="value-display">5</span>
            </div>
            
            <div class="professional-mode slider-container">
                <label for="nutty" data-i18n="nutty">堅果感：</label>
                <input type="range" id="nutty" min="1" max="10" value="5">
                <span id="nutty-value" class="value-display">5</span>
            </div>
            
            <div class="professional-mode slider-container">
                <label for="chocolate" data-i18n="chocolate">朱古力感：</label>
                <input type="range" id="chocolate" min="1" max="10" value="5">
                <span id="chocolate-value" class="value-display">5</span>
            </div>
            
            <div class="professional-mode slider-container">
                <label for="floral" data-i18n="floral">花香：</label>
                <input type="range" id="floral" min="1" max="10" value="5">
                <span id="floral-value" class="value-display">5</span>
            </div>
            
            <div class="professional-mode roast-selector">
                <h3 data-i18n="roast-level">烘焙程度：</h3>
                <div class="roast-levels">
                    <button class="roast-btn" data-roast="light" data-i18n="light-roast">淺烘焙</button>
                    <button class="roast-btn active" data-roast="medium" data-i18n="medium-roast">中烘焙</button>
                    <button class="roast-btn" data-roast="dark" data-i18n="dark-roast">深烘焙</button>
                    <span class="roast-selector-highlight"></span>
                </div>
            </div>
            
            <div class="filter-options">
                <h3 data-i18n="region-filter">產區篩選：</h3>
                <div class="region-buttons">
                    <button class="region-btn active" data-region="africa" data-i18n="africa">非洲</button>
                    <button class="region-btn active" data-region="americas" data-i18n="americas">美洲</button>
                    <button class="region-btn active" data-region="asia" data-i18n="asia">亞洲</button>
                </div>
            </div>
            
            <div class="professional-mode filter-options">
                <h3 data-i18n="processing-filter">處理法篩選：</h3>
                <div class="region-buttons">
                    <button class="region-btn active" data-process="washed" data-i18n="washed">水洗</button>
                    <button class="region-btn active" data-process="natural" data-i18n="natural">日曬</button>
                    <button class="region-btn active" data-process="honey" data-i18n="honey">蜜處理</button>
                    <button class="region-btn active" data-process="anaerobic" data-i18n="anaerobic">厭氧發酵</button>
                </div>
            </div>
            
            <div class="professional-mode filter-options">
                <h3 data-i18n="altitude">海拔高度：</h3>
                <div class="slider-container">
                    <input type="range" id="altitude" min="800" max="2200" value="1500" step="100">
                    <span id="altitude-value" class="value-display">1500</span>
                    <span data-i18n="meters" style="margin-left: 5px;">公尺</span>
                </div>
            </div>
            
            <div class="controls-row">
                <div class="results-count">
                    <label for="num-results" data-i18n="results-count">顯示結果數量：</label>
                    <input type="number" id="num-results" min="1" max="10" value="3">
                </div>
                
                <button id="search-button" class="search-button">
                    <span class="search-icon"></span>
                    <span data-i18n="search-button">推薦咖啡豆</span>
                </button>
            </div>
            
            <div class="loading" id="loading-indicator">
                <div class="loading-spinner"></div>
                <div class="loading-text" data-i18n="loading-text">正在搜尋最合適的咖啡豆...</div>
            </div>
            
            <div class="error-message" id="error-message" data-i18n="error-message">
                無法載入咖啡豆資料，請稍後再試。
            </div>
        </div>
        
        <div id="results">
            <h2 data-i18n="recommendation-title">為你推薦的咖啡豆</h2>
            <p data-i18n="recommendation-subtitle">根據你的口味喜好，以下是最適合你的咖啡豆：</p>
            <div id="coffee-recommendations"></div>
            <div class="data-source" id="data-source-info" data-i18n="data-source">資料來源：咖啡風味資料庫</div>
        </div>
    </div>
    
    <script>
        // 語言定義
        const translations = {
            'zh': {
                'title': '咖啡風味探索器',
                'lang-zh': '中文',
                'lang-en': 'English',
                'simple-mode': '簡易模式',
                'professional-mode': '專業模式',
                'flavor-preference-title': '調整你喜好的咖啡風味',
                'slider-instructions': '拖動滑桿以設定你理想的咖啡特性：',
                'acidity': '酸度：',
                'body': '厚度：',
                'sweetness': '甜度：',
                'bitterness': '苦度：',
                'fruity': '果香：',
                'nutty': '堅果感：',
                'chocolate': '朱古力感：',
                'floral': '花香：',
                'roast-level': '烘焙程度：',
                'light-roast': '淺烘焙',
                'medium-roast': '中烘焙',
                'dark-roast': '深烘焙',
                'region-filter': '產區篩選：',
                'africa': '非洲',
                'americas': '美洲',
                'asia': '亞洲',
                'processing-filter': '處理法篩選：',
                'washed': '水洗',
                'natural': '日曬',
                'honey': '蜜處理',
                'anaerobic': '厭氧發酵',
                'altitude': '海拔高度：',
                'meters': '公尺',
                'results-count': '顯示結果數量：',
                'search-button': '推薦咖啡豆',
                'loading-text': '正在搜尋最合適的咖啡豆...',
                'error-message': '無法載入咖啡豆資料，請稍後再試。',
                'recommendation-title': '為你推薦的咖啡豆',
                'recommendation-subtitle': '根據你的口味喜好，以下是最適合你的咖啡豆：',
                'data-source': '資料來源：咖啡風味資料庫',
                'no-results': '沒有符合你篩選條件的咖啡豆。請嘗試調整產區或處理法篩選。',
                'brewing-tips-title': '沖煮小貼士：',
                'african-region': '非洲',
                'american-region': '美洲',
                'asian-region': '亞洲',
                'washed-process': '水洗',
                'natural-process': '日曬',
                'honey-process': '蜜處理',
                'anaerobic-process': '厭氧發酵',
                'light-roast-level': '淺烘焙',
                'medium-light-roast-level': '中淺烘焙',
                'medium-roast-level': '中烘焙',
                'medium-dark-roast-level': '中深烘焙',
                'dark-roast-level': '深烘焙',
                'origin': '產地：',
                'estate': '莊園：',
                'unknown': '未知',
                'varieties': '品種：',
                'altitude-value': '海拔：',
                'processing': '處理法：',
                'roast': '烘焙：',
                'cupping-score': '杯測分數：'
            },
            'en': {
                'title': 'Coffee Flavor Explorer',
                'lang-zh': '中文',
                'lang-en': 'English',
                'simple-mode': 'Simple Mode',
                'professional-mode': 'Professional Mode',
                'flavor-preference-title': 'Customize Your Coffee Preferences',
                'slider-instructions': 'Adjust the sliders to set your ideal coffee characteristics:',
                'acidity': 'Acidity:',
                'body': 'Body:',
                'sweetness': 'Sweetness:',
                'bitterness': 'Bitterness:',
                'fruity': 'Fruitiness:',
                'nutty': 'Nuttiness:',
                'chocolate': 'Chocolate:',
                'floral': 'Floral:',
                'roast-level': 'Roast Level:',
                'light-roast': 'Light',
                'medium-roast': 'Medium',
                'dark-roast': 'Dark',
                'region-filter': 'Region Filter:',
                'africa': 'Africa',
                'americas': 'Americas',
                'asia': 'Asia',
                'processing-filter': 'Processing Method:',
                'washed': 'Washed',
                'natural': 'Natural',
                'honey': 'Honey',
                'anaerobic': 'Anaerobic',
                'altitude': 'Altitude:',
                'meters': 'meters',
                'results-count': 'Number of results:',
                'search-button': 'Find Coffee Beans',
                'loading-text': 'Searching for the perfect coffee beans...',
                'error-message': 'Unable to load coffee data. Please try again later.',
                'recommendation-title': 'Recommended Coffee Beans',
                'recommendation-subtitle': 'Based on your preferences, here are the best coffee beans for you:',
                'data-source': 'Data source: Coffee Flavor Database',
                'no-results': 'No coffee beans match your filter criteria. Please try adjusting your region or processing method filters.',
                'brewing-tips-title': 'Brewing Tips:',
                'african-region': 'Africa',
                'american-region': 'Americas',
                'asian-region': 'Asia',
                'washed-process': 'Washed',
                'natural-process': 'Natural',
                'honey-process': 'Honey',
                'anaerobic-process': 'Anaerobic',
                'light-roast-level': 'Light',
                'medium-light-roast-level': 'Medium-Light',
                'medium-roast-level': 'Medium',
                'medium-dark-roast-level': 'Medium-Dark',
                'dark-roast-level': 'Dark',
                'origin': 'Origin:',
                'estate': 'Estate:',
                'unknown': 'Unknown',
                'varieties': 'Varieties:',
                'altitude-value': 'Altitude:',
                'processing': 'Processing:',
                'roast': 'Roast:',
                'cupping-score': 'Cupping Score:'
            }
        };
        
        // 英文版本咖啡豆數據庫
        const coffeeBeans_en = [
            // Africa
            {
                name: "Ethiopia Yirgacheffe G1",
                origin: "Ethiopia",
                region: "africa",
                estate: "Yirgacheffe Cooperative",
                varieties: "Heirloom/Ethiopian Landrace",
                altitude: 1950,
                processing: "washed",
                roast: "light",
                acidity: 8,
                body: 4,
                sweetness: 7,
                bitterness: 3,
                fruity: 9,
                nutty: 2,
                chocolate: 3,
                floral: 8,
                cupping_score: 87.5,
                description: "Fresh floral aroma with citrus and blueberry flavors, accompanied by honey-like sweetness.",
                brewingTips: "Water temp: 90-92°C, Grind size: Medium-fine, Brewing time: 2:30 min."
            },
            {
                name: "Ethiopia Sidamo G1",
                origin: "Ethiopia",
                region: "africa",
                estate: "Sidamo Cooperative",
                varieties: "Ethiopian Landrace",
                altitude: 1850,
                processing: "washed",
                roast: "light",
                acidity: 7,
                body: 5,
                sweetness: 8,
                bitterness: 3,
                fruity: 8,
                nutty: 3,
                chocolate: 4,
                floral: 7,
                cupping_score: 86.5,
                description: "Lemon and citrus flavors with honey sweetness and jasmine floral notes in the finish.",
                brewingTips: "Water temp: 90-92°C, Grind size: Medium-fine, Brewing time: 2:15 min."
            },
            {
                name: "Ethiopia Guji Albasel",
                origin: "Ethiopia",
                region: "africa",
                estate: "Guji Albasel Cooperative",
                varieties: "Ethiopian Landrace/74110/74112",
                altitude: 2000,
                processing: "natural",
                roast: "light",
                acidity: 8,
                body: 4,
                sweetness: 8,
                bitterness: 2,
                fruity: 9,
                nutty: 2,
                chocolate: 2,
                floral: 9,
                cupping_score: 88.5,
                description: "Bright acidity with tropical fruit flavors and sweet floral notes.",
                brewingTips: "Water temp: 89-91°C, Grind size: Medium-fine, Brewing time: 2:20 min."
            },
            {
                name: "Ethiopia Gesha",
                origin: "Ethiopia",
                region: "africa",
                estate: "Gesha Region",
                varieties: "Gesha",
                altitude: 1950,
                processing: "natural",
                roast: "light",
                acidity: 7,
                body: 5,
                sweetness: 8,
                bitterness: 3,
                fruity: 9,
                nutty: 3,
                chocolate: 4,
                floral: 8,
                cupping_score: 88,
                description: "Rich strawberry and blueberry flavors with jasmine floral notes and honey sweetness.",
                brewingTips: "Water temp: 89-91°C, Grind size: Medium-fine, Brewing time: 2:15 min."
            },
            {
                name: "Ethiopia Kochere Washed",
                origin: "Ethiopia",
                region: "africa",
                estate: "Bangi Cooperative",
                varieties: "Ethiopian Landrace",
                altitude: 1900,
                processing: "washed",
                roast: "light",
                acidity: 8,
                body: 5,
                sweetness: 7,
                bitterness: 3,
                fruity: 8,
                nutty: 3,
                chocolate: 3,
                floral: 8,
                cupping_score: 87,
                description: "Elegant floral notes with citrus and peach flavors, finishing with a refreshing tea-like quality.",
                brewingTips: "Water temp: 90-92°C, Grind size: Medium-fine, Brewing time: 2:20 min."
            },
            {
                name: "Kenya Nyeri AA TOP",
                origin: "Kenya",
                region: "africa",
                estate: "Nyeri Central Region",
                varieties: "SL28/SL34",
                altitude: 1800,
                processing: "washed",
                roast: "medium",
                acidity: 9,
                body: 6,
                sweetness: 7,
                bitterness: 4,
                fruity: 8,
                nutty: 3,
                chocolate: 4,
                floral: 5,
                cupping_score: 88,
                description: "Intense blackcurrant and grapefruit flavors with floral honey sweetness.",
                brewingTips: "Water temp: 91-93°C, Grind size: Medium-fine, Brewing time: 2:15 min."
            },
            // More Africa coffees...
            
            // Americas
            {
                name: "Colombia Supremo Huila",
                origin: "Colombia",
                region: "americas",
                estate: "Huila Region",
                varieties: "Caturra/Castillo",
                altitude: 1800,
                processing: "washed",
                roast: "medium",
                acidity: 6,
                body: 7,
                sweetness: 6,
                bitterness: 5,
                fruity: 6,
                nutty: 5,
                chocolate: 7,
                floral: 3,
                cupping_score: 85,
                description: "Balanced sweetness and acidity with caramel and red apple flavors, finishing with cocoa notes.",
                brewingTips: "Water temp: 93-94°C, Grind size: Medium, Brewing time: 2:45 min."
            },
            {
                name: "Guatemala Antigua La Minita",
                origin: "Guatemala",
                region: "americas",
                estate: "La Minita Estate",
                varieties: "Bourbon/Caturra",
                altitude: 1700,
                processing: "washed",
                roast: "medium",
                acidity: 5,
                body: 8,
                sweetness: 6,
                bitterness: 6,
                fruity: 4,
                nutty: 7,
                chocolate: 8,
                floral: 2,
                cupping_score: 84.5,
                description: "Rich chocolate flavor with nutty aroma and balanced citrus acidity.",
                brewingTips: "Water temp: 92-94°C, Grind size: Medium-coarse, Brewing time: 3:00 min."
            },
            {
                name: "Brazil Yellow Bourbon",
                origin: "Brazil",
                region: "americas",
                estate: "Tolones Farm",
                varieties: "Yellow Bourbon",
                altitude: 1200,
                processing: "natural",
                roast: "medium-dark",
                acidity: 4,
                body: 8,
                sweetness: 6,
                bitterness: 7,
                fruity: 3,
                nutty: 8,
                chocolate: 7,
                floral: 2,
                cupping_score: 83,
                description: "Rich nutty and caramel flavors, low acidity with cocoa finish.",
                brewingTips: "Water temp: 94-95°C, Grind size: Medium, Brewing time: 2:45 min."
            },
            {
                name: "Panama Geisha Esmeralda",
                origin: "Panama",
                region: "americas",
                estate: "Esmeralda Estate",
                varieties: "Geisha",
                altitude: 1700,
                processing: "washed",
                roast: "light",
                acidity: 8,
                body: 5,
                sweetness: 9,
                bitterness: 3,
                fruity: 9,
                nutty: 3,
                chocolate: 4,
                floral: 9,
                cupping_score: 90,
                description: "Distinct jasmine floral notes with tropical fruit flavors and a tea-like mouthfeel.",
                brewingTips: "Water temp: 88-90°C, Grind size: Medium-fine, Brewing time: 2:15 min."
            },
            {
                name: "Costa Rica Anaerobic Chirripo",
                origin: "Costa Rica",
                region: "americas",
                estate: "Chirripo Estate",
                varieties: "Red Catuai/Villa Sarchi",
                altitude: 1800,
                processing: "anaerobic",
                roast: "medium",
                acidity: 7,
                body: 6,
                sweetness: 8,
                bitterness: 3,
                fruity: 9,
                nutty: 4,
                chocolate: 6,
                floral: 5,
                cupping_score: 89,
                description: "Wine-like flavors with dark berries and tropical fruit notes, complex fermented fruit taste.",
                brewingTips: "Water temp: 91-92°C, Grind size: Medium-fine, Brewing time: 2:20 min."
            },
            // More Americas coffees...
            
            // Asia
            {
                name: "Indonesia Sumatra Mandheling",
                origin: "Indonesia",
                region: "asia",
                estate: "Lintong Cooperative",
                varieties: "Typica/Sumatra Varietals",
                altitude: 1400,
                processing: "natural",
                roast: "dark",
                acidity: 3,
                body: 9,
                sweetness: 5,
                bitterness: 8,
                fruity: 2,
                nutty: 7,
                chocolate: 9,
                floral: 1,
                cupping_score: 82,
                description: "Rich and full-bodied with earthy, spicy notes and dark chocolate flavors.",
                brewingTips: "Water temp: 94-96°C, Grind size: Medium-coarse, Brewing time: 3:15 min."
            },
            {
                name: "Taiwan Ali Mountain",
                origin: "Taiwan",
                region: "asia",
                estate: "Dabang Farm",
                varieties: "Typica/Red Bourbon",
                altitude: 1100,
                processing: "honey",
                roast: "medium",
                acidity: 6,
                body: 7,
                sweetness: 7,
                bitterness: 5,
                fruity: 5,
                nutty: 6,
                chocolate: 5,
                floral: 5,
                cupping_score: 84,
                description: "Smooth mouthfeel with honey and brown sugar sweetness, finishing with cinnamon and nutty notes.",
                brewingTips: "Water temp: 92-93°C, Grind size: Medium, Brewing time: 2:30 min."
            },
            {
                name: "Yemen Mocha Matari Haraaz",
                origin: "Yemen",
                region: "asia",
                estate: "Haraaz District Cooperative",
                varieties: "Yemen Mocha (Local Landrace)",
                altitude: 2000,
                processing: "natural",
                roast: "medium",
                acidity: 6,
                body: 6,
                sweetness: 7,
                bitterness: 5,
                fruity: 7,
                nutty: 5,
                chocolate: 5,
                floral: 6,
                cupping_score: 87,
                description: "Dried fruit and berry flavors with spice and chocolate notes, pronounced sweetness.",
                brewingTips: "Water temp: 91-93°C, Grind size: Medium, Brewing time: 2:30 min."
            }
            // More Asia coffees...
        ];
        
        // 中文版咖啡豆數據庫
        const coffeeBeans_zh = [
            // 非洲產區
            {
                name: "衣索比亞 耶加雪菲 G1",
                origin: "衣索比亞",
                region: "africa",
                estate: "耶加雪菲合作社",
                varieties: "原生種海勒姆/原生種衣索比亞蘭登品種",
                altitude: 1950,
                processing: "washed",
                roast: "light",
                acidity: 8,
                body: 4,
                sweetness: 7,
                bitterness: 3,
                fruity: 9,
                nutty: 2,
                chocolate: 3,
                floral: 8,
                cupping_score: 87.5,
                description: "清新花香，柑橘和藍莓風味，帶有蜜糖般的甜味。",
                brewingTips: "水溫: 90-92°C，研磨度: 中細，沖煮時間: 2分30秒。"
            },
            {
                name: "衣索比亞 西達摩 G1",
                origin: "衣索比亞",
                region: "africa",
                estate: "西達摩合作社",
                varieties: "原生種衣索比亞蘭登品種",
                altitude: 1850,
                processing: "washed",
                roast: "light",
                acidity: 7,
                body: 5,
                sweetness: 8,
                bitterness: 3,
                fruity: 8,
                nutty: 3,
                chocolate: 4,
                floral: 7,
                cupping_score: 86.5,
                description: "檸檬和柑橘風味，尾韻帶有蜂蜜甜感和茉莓花香。",
                brewingTips: "水溫: 90-92°C，研磨度: 中細，沖煮時間: 2分15秒。"
            },
            {
                name: "衣索比亞 古吉 阿爾巴塞爾",
                origin: "衣索比亞",
                region: "africa",
                estate: "古吉 阿爾巴塞爾合作社",
                varieties: "原生種衣索比亞蘭登品種/74110/74112",
                altitude: 2000,
                processing: "natural",
                roast: "light",
                acidity: 8,
                body: 4,
                sweetness: 8,
                bitterness: 2,
                fruity: 9,
                nutty: 2,
                chocolate: 2,
                floral: 9,
                cupping_score: 88.5,
                description: "明亮的酸度，帶有熱帶水果風味和甜美的花香。",
                brewingTips: "水溫: 89-91°C，研磨度: 中細，沖煮時間: 2分20秒。"
            },
            {
                name: "衣索比亞 花魁",
                origin: "衣索比亞",
                region: "africa",
                estate: "花魁產區",
                varieties: "花魁品種",
                altitude: 1950,
                processing: "natural",
                roast: "light",
                acidity: 7,
                body: 5,
                sweetness: 8,
                bitterness: 3,
                fruity: 9,
                nutty: 3,
                chocolate: 4,
                floral: 8,
                cupping_score: 88,
                description: "濃郁的草莓和藍莓風味，帶有茉莉花香和蜂蜜甜感。",
                brewingTips: "水溫: 89-91°C，研磨度: 中細，沖煮時間: 2分15秒。"
            },
            {
                name: "衣索比亞 柯爾扎 水洗",
                origin: "衣索比亞",
                region: "africa",
                estate: "班吉合作社",
                varieties: "原生種衣索比亞蘭登品種",
                altitude: 1900,
                processing: "washed",
                roast: "light",
                acidity: 8,
                body: 5,
                sweetness: 7,
                bitterness: 3,
                fruity: 8,
                nutty: 3,
                chocolate: 3,
                floral: 8,
                cupping_score: 87,
                description: "優雅的花香，帶有柑橘和蜜桃風味，尾韻有清爽的茶感。",
                brewingTips: "水溫: 90-92°C，研磨度: 中細，沖煮時間: 2分20秒。"
            },
            {
                name: "肯亞 奈洛比 AA TOP",
                origin: "肯亞",
                region: "africa",
                estate: "奈洛比中部產區",
                varieties: "SL28/SL34",
                altitude: 1800,
                processing: "washed",
                roast: "medium",
                acidity: 9,
                body: 6,
                sweetness: 7,
                bitterness: 4,
                fruity: 8,
                nutty: 3,
                chocolate: 4,
                floral: 5,
                cupping_score: 88,
                description: "強烈的黑醋栗和葡萄柚風味，帶有花蜜甜感。",
                brewingTips: "水溫: 91-93°C，研磨度: 中細，沖煮時間: 2分15秒。"
            },
            // 更多非洲咖啡...
            
            // 美洲產區
            {
                name: "哥倫比亞 蘇普雷莫 烏爾拉奧",
                origin: "哥倫比亞",
                region: "americas",
                estate: "烏爾拉奧產區",
                varieties: "卡杜拉/卡杜愛",
                altitude: 1800,
                processing: "washed",
                roast: "medium",
                acidity: 6,
                body: 7,
                sweetness: 6,
                bitterness: 5,
                fruity: 6,
                nutty: 5,
                chocolate: 7,
                floral: 3,
                cupping_score: 85,
                description: "平衡的酸甜度，有焦糖和紅蘋果的風味，尾韻帶有可可香。",
                brewingTips: "水溫: 93-94°C，研磨度: 中，沖煮時間: 2分45秒。"
            },
            {
                name: "瓜地馬拉 安提瓜 拉米內薩",
                origin: "瓜地馬拉",
                region: "americas",
                estate: "拉米內薩莊園",
                varieties: "波旁/卡杜拉",
                altitude: 1700,
                processing: "washed",
                roast: "medium",
                acidity: 5,
                body: 8,
                sweetness: 6,
                bitterness: 6,
                fruity: 4,
                nutty: 7,
                chocolate: 8,
                floral: 2,
                cupping_score: 84.5,
                description: "豐富的朱古力風味，帶有堅果香氣，平衡的柑橘酸度。",
                brewingTips: "水溫: 92-94°C，研磨度: 中粗，沖煮時間: 3分鐘。"
            },
            {
                name: "巴西 黃波旁 摩吉安那",
                origin: "巴西",
                region: "americas",
                estate: "托洛內斯農場",
                varieties: "黃波旁",
                altitude: 1200,
                processing: "natural",
                roast: "medium-dark",
                acidity: 4,
                body: 8,
                sweetness: 6,
                bitterness: 7,
                fruity: 3,
                nutty: 8,
                chocolate: 7,
                floral: 2,
                cupping_score: 83,
                description: "濃郁的堅果和焦糖風味，低酸度，帶有可可的尾韻。",
                brewingTips: "水溫: 94-95°C，研磨度: 中，沖煮時間: 2分45秒。"
            },
            {
                name: "巴拿馬 藝伎 翡翠莊園",
                origin: "巴拿馬",
                region: "americas",
                estate: "翡翠莊園",
                varieties: "藝伎",
                altitude: 1700,
                processing: "washed",
                roast: "light",
                acidity: 8,
                body: 5,
                sweetness: 9,
                bitterness: 3,
                fruity: 9,
                nutty: 3,
                chocolate: 4,
                floral: 9,
                cupping_score: 90,
                description: "特殊的茉莉花香，帶有熱帶水果風味，仙草茶般的口感。",
                brewingTips: "水溫: 88-90°C，研磨度: 中細，沖煮時間: 2分15秒。"
            },
            {
                name: "哥斯達黎加 特殊厭氧發酵 奇里波",
                origin: "哥斯達黎加",
                region: "americas",
                estate: "奇里波莊園",
                varieties: "紅卡杜艾/維拉薩契",
                altitude: 1800,
                processing: "anaerobic",
                roast: "medium",
                acidity: 7,
                body: 6,
                sweetness: 8,
                bitterness: 3,
                fruity: 9,
                nutty: 4,
                chocolate: 6,
                floral: 5,
                cupping_score: 89,
                description: "葡萄酒般的風味，帶有深色莓果和熱帶水果香氣，複雜的發酵果味。",
                brewingTips: "水溫: 91-92°C，研磨度: 中細，沖煮時間: 2分20秒。"
            },
            // 更多美洲咖啡...
            
            // 亞洲產區
            {
                name: "印尼 蘇門答臘曼特寧 林同",
                origin: "印尼",
                region: "asia",
                estate: "林同合作社",
                varieties: "帝皮卡/蘇門答臘種",
                altitude: 1400,
                processing: "natural",
                roast: "dark",
                acidity: 3,
                body: 9,
                sweetness: 5,
                bitterness: 8,
                fruity: 2,
                nutty: 7,
                chocolate: 9,
                floral: 1,
                cupping_score: 82,
                description: "濃郁醇厚，帶有泥土香、香料和黑朱古力味道。",
                brewingTips: "水溫: 94-96°C，研磨度: 中粗，沖煮時間: 3分15秒。"
            },
            {
                name: "台灣 阿里山 達邦",
                origin: "台灣",
                region: "asia",
                estate: "達邦農場",
                varieties: "鐵比卡/紅波旁",
                altitude: 1100,
                processing: "honey",
                roast: "medium",
                acidity: 6,
                body: 7,
                sweetness: 7,
                bitterness: 5,
                fruity: 5,
                nutty: 6,
                chocolate: 5,
                floral: 5,
                cupping_score: 84,
                description: "滑順口感，帶有蜂蜜和紅糖甜感，尾韻有肉桂和堅果風味。",
                brewingTips: "水溫: 92-93°C，研磨度: 中，沖煮時間: 2分30秒。"
            },
            {
                name: "也門 莫卡馬塔里 哈拉茲",
                origin: "也門",
                region: "asia",
                estate: "哈拉茲地區合作社",
                varieties: "也門本地種 (莫卡)",
                altitude: 2000,
                processing: "natural",
                roast: "medium",
                acidity: 6,
                body: 6,
                sweetness: 7,
                bitterness: 5,
                fruity: 7,
                nutty: 5,
                chocolate: 5,
                floral: 6,
                cupping_score: 87,
                description: "乾果和漿果風味，帶有香料和朱古力香氣，甜感明顯。",
                brewingTips: "水溫: 91-93°C，研磨度: 中，沖煮時間: 2分30秒。"
            }
            // 更多亞洲咖啡...
        ];
        
        // 視目前語言切換咖啡豆數據庫
        function getCoffeeBeansData() {
            const currentLang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
            return currentLang === 'zh' ? coffeeBeans_zh : coffeeBeans_en;
        }
        
        // 安全存儲用戶偏好
        function safelyStorePreference(key, value) {
            try {
                localStorage.setItem(key, value);
            } catch (e) {
                console.warn('Unable to store user preference:', e);
            }
        }

        // 安全獲取用戶偏好
        function safelyGetPreference(key, defaultValue) {
            try {
                const value = localStorage.getItem(key);
                return value !== null ? value : defaultValue;
            } catch (e) {
                console.warn('Unable to retrieve user preference:', e);
                return defaultValue;
            }
        }
        
        // 設置頁面語言
        function setLanguage(lang) {
            document.documentElement.lang = lang === 'zh' ? 'zh-HK' : 'en';
            
            // 更新所有文本內容
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // 更新頁面標題
            document.title = lang === 'zh' ? 
                '咖啡風味探索器 - 找到最適合你口味的咖啡豆' : 
                'Coffee Flavor Explorer - Find Your Perfect Coffee Bean';
                
            // 更新meta描述
            const metaDescription = document.querySelector('meta[name="description"]');
            if (metaDescription) {
                metaDescription.content = lang === 'zh' ? 
                    '使用咖啡風味探索器根據您的口味偏好，在數十種精選咖啡豆中找到完美匹配。探索來自非洲、美洲和亞洲的頂級咖啡產區。' : 
                    'Use the Coffee Flavor Explorer to find the perfect match among dozens of premium coffee beans based on your taste preferences. Explore top coffee regions from Africa, Americas, and Asia.';
            }
            
            // 更新語言切換按鈕狀態
            document.querySelectorAll('.language-switcher a').forEach(link => {
                if (link.getAttribute('data-lang') === lang) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // 如果有搜索結果已顯示，重新生成推薦
            if (document.getElementById('results').style.display === 'block') {
                generateRecommendations(getCoffeeBeansData());
            }
            
            // 更新規範連結
            const canonicalLink = document.querySelector('link[rel="canonical"]');
            if (canonicalLink) {
                canonicalLink.href = lang === 'zh' ? 'https://coffeematcher.me/' : 'https://coffeematcher.me/en/';
            }
            
            // 安全地存儲用戶語言偏好
            safelyStorePreference('preferredLanguage', lang);
            
            // 更新選擇器寬度以適應不同語言的文本長度
            setTimeout(updateSelectorWidth, 0);
        }
        
        // 創建背景咖啡豆
        function createCoffeeBeans() {
            const container = document.getElementById('coffee-beans-bg');
            const numBeans = 40;
            
            for (let i = 0; i < numBeans; i++) {
                const bean = document.createElement('div');
                bean.className = 'coffee-bean';
                
                const size = Math.random() * 30 + 20;
                const rotation = Math.random() * 360;
                
                bean.style.width = `${size}px`;
                bean.style.height = `${size * 1.6}px`;
                bean.style.top = `${Math.random() * 100}%`;
                bean.style.left = `${Math.random() * 100}%`;
                bean.style.setProperty('--rotation', `${rotation}deg`);
                
                container.appendChild(bean);
            }
        }
        
        // 更新選擇器寬度函數
        function updateSelectorWidth() {
            const activeButton = document.querySelector('.toggle-btn.active');
            if (activeButton) {
                const buttonWidth = activeButton.offsetWidth;
                selector.style.width = buttonWidth + 'px';
                
                // 更新選擇器位置
                if (activeButton.id === 'professional-mode-btn') {
                    const distance = simpleModeBtn.offsetWidth;
                    selector.style.transform = `translateX(${distance}px)`;
                } else {
                    selector.style.transform = 'translateX(0)';
                }
            }
        }
        
        // 模式切換
        const simpleModeBtn = document.getElementById('simple-mode-btn');
        const professionalModeBtn = document.getElementById('professional-mode-btn');
        const professionalElements = document.querySelectorAll('.professional-mode');
        const selector = document.querySelector('.selector');
        
        // 初始設定為簡易模式
        let isProfessionalMode = false;
        
        // 簡易模式切換
        simpleModeBtn.addEventListener('click', function() {
            isProfessionalMode = false;
            simpleModeBtn.classList.add('active');
            professionalModeBtn.classList.remove('active');
            professionalElements.forEach(element => {
                element.style.display = 'none';
            });
            updateSelectorWidth();
        });
        
        // 專業模式切換
        professionalModeBtn.addEventListener('click', function() {
            isProfessionalMode = true;
            professionalModeBtn.classList.add('active');
            simpleModeBtn.classList.remove('active');
            professionalElements.forEach(element => {
                element.style.display = 'block';
            });
            updateSelectorWidth();
        });
        
        // 更新滑桿值顯示
        document.querySelectorAll('input[type="range"]').forEach(input => {
            input.addEventListener('input', function() {
                document.getElementById(`${this.id}-value`).textContent = this.value;
            });
        });
        
        // 烘焙程度選擇
        const roastButtons = document.querySelectorAll('.roast-btn');
        const roastHighlight = document.querySelector('.roast-selector-highlight');
        
        roastButtons.forEach((button, index) => {
            button.addEventListener('click', function() {
                // 移除所有按鈕的active類
                roastButtons.forEach(btn => btn.classList.remove('active'));
                // 給當前點擊的按鈕添加active類
                this.classList.add('active');
                // 移動highlight
                const width = 100 / roastButtons.length;
                const offset = index * width;
                roastHighlight.style.width = `${width}%`;
                roastHighlight.style.transform = `translateX(${offset}%)`;
            });
        });
        
        // 產區和處理法按鈕
        document.querySelectorAll('.region-btn').forEach(button => {
            button.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        });
        
        // 根據使用者喜好生成推薦
        function generateRecommendations(coffeeBeans) {
            // 顯示載入動畫
            document.getElementById('loading-indicator').style.display = 'block';
            
            setTimeout(() => {
                // 獲取用戶偏好
                const userPreferences = {
                    acidity: parseInt(document.getElementById('acidity').value),
                    body: parseInt(document.getElementById('body').value),
                    sweetness: parseInt(document.getElementById('sweetness').value),
                    bitterness: parseInt(document.getElementById('bitterness').value),
                    fruity: isProfessionalMode ? parseInt(document.getElementById('fruity').value) : 5,
                    nutty: isProfessionalMode ? parseInt(document.getElementById('nutty').value) : 5,
                    chocolate: isProfessionalMode ? parseInt(document.getElementById('chocolate').value) : 5,
                    floral: isProfessionalMode ? parseInt(document.getElementById('floral').value) : 5,
                    altitude: isProfessionalMode ? parseInt(document.getElementById('altitude').value) : 1500
                };
                
                // 獲取烘焙程度
                let selectedRoast = 'medium';
                if (isProfessionalMode) {
                    document.querySelectorAll('.roast-btn').forEach(btn => {
                        if (btn.classList.contains('active')) {
                            selectedRoast = btn.dataset.roast;
                        }
                    });
                }
                
                // 取得產區篩選
                const includeAfrica = document.querySelector('[data-region="africa"]').classList.contains('active');
                const includeAmericas = document.querySelector('[data-region="americas"]').classList.contains('active');
                const includeAsia = document.querySelector('[data-region="asia"]').classList.contains('active');
                
                // 取得處理法篩選
                let includeWashed = true;
                let includeNatural = true;
                let includeHoney = true;
                let includeAnaerobic = true;
                
                if (isProfessionalMode) {
                    includeWashed = document.querySelector('[data-process="washed"]').classList.contains('active');
                    includeNatural = document.querySelector('[data-process="natural"]').classList.contains('active');
                    includeHoney = document.querySelector('[data-process="honey"]').classList.contains('active');
                    includeAnaerobic = document.querySelector('[data-process="anaerobic"]').classList.contains('active');
                }
                
                // 結果數量
                const numResults = parseInt(document.getElementById('num-results').value);
                
                // 篩選咖啡豆
                let filteredBeans = coffeeBeans.filter(bean => {
                    if (bean.region === 'africa' && !includeAfrica) return false;
                    if (bean.region === 'americas' && !includeAmericas) return false;
                    if (bean.region === 'asia' && !includeAsia) return false;
                    
                    if (isProfessionalMode) {
                        if (bean.processing === 'washed' && !includeWashed) return false;
                        if (bean.processing === 'natural' && !includeNatural) return false;
                        if (bean.processing === 'honey' && !includeHoney) return false;
                        if (bean.processing === 'anaerobic' && !includeAnaerobic) return false;
                        
                        // 烘焙程度篩選
                        if (selectedRoast !== bean.roast && 
                            !(selectedRoast === 'medium' && (bean.roast === 'medium-light' || bean.roast === 'medium-dark'))) {
                            return false;
                        }
                        
                        // 海拔篩選 (允許±300米誤差)
                        const altitudeDiff = Math.abs(bean.altitude - userPreferences.altitude);
                        if (altitudeDiff > 300) return false;
                    }
                    
                    return true;
                });
                
                // 計算每種咖啡豆與用戶偏好的匹配度
                const scores = filteredBeans.map(bean => {
                    const acidityDiff = Math.abs(bean.acidity - userPreferences.acidity);
                    const bodyDiff = Math.abs(bean.body - userPreferences.body);
                    const sweetnessDiff = Math.abs(bean.sweetness - userPreferences.sweetness);
                    const bitternessDiff = Math.abs(bean.bitterness - userPreferences.bitterness);
                    
                    // 基本分數權重
                    let totalDiff = (acidityDiff + bodyDiff + sweetnessDiff + bitternessDiff) * 1.5;
                    
                    if (isProfessionalMode) {
                        const fruityDiff = Math.abs(bean.fruity - userPreferences.fruity);
                        const nuttyDiff = Math.abs(bean.nutty - userPreferences.nutty);
                        const chocolateDiff = Math.abs(bean.chocolate - userPreferences.chocolate);
                        const floralDiff = Math.abs(bean.floral - userPreferences.floral);
                        
                        totalDiff += fruityDiff + nuttyDiff + chocolateDiff + floralDiff;
                        
                        // 專業模式下優先考慮杯測分高的咖啡
                        if (bean.cupping_score) {
                            totalDiff -= (bean.cupping_score - 80) / 5; // 分數較高的獲得更高優先級
                        }
                    }
                    
                    return {
                        bean: bean,
                        score: totalDiff
                    };
                });
                
                // 排序咖啡豆（分數低的排前面）
                scores.sort((a, b) => a.score - b.score);
                
                // 取指定數量的最匹配的咖啡豆
                const topRecommendations = scores.slice(0, numResults);
                
                // 顯示結果
                const recommendationsContainer = document.getElementById('coffee-recommendations');
                const resultsSection = document.getElementById('results');
                
                recommendationsContainer.innerHTML = '';
                resultsSection.style.display = 'block';
                
                // 添加淡入效果
                setTimeout(() => {
                    resultsSection.classList.add('show');
                }, 50);
                
                const currentLang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
                
                if (topRecommendations.length === 0) {
                    recommendationsContainer.innerHTML = `<p>${translations[currentLang]['no-results']}</p>`;
                } else {
                    topRecommendations.forEach((item, index) => {
                        const bean = item.bean;
                        const beanElement = document.createElement('div');
                        beanElement.className = 'coffee-bean-card';
                        
                        // 延遲顯示每個咖啡豆卡片
                        setTimeout(() => {
                            beanElement.classList.add('show');
                            
                            if (!isProfessionalMode) {
                                // 添加風味條動畫
                                const bars = beanElement.querySelectorAll('.flavor-fill');
                                bars.forEach(bar => {
                                    setTimeout(() => {
                                        bar.style.width = bar.dataset.width;
                                    }, 200);
                                });
                            }
                        }, 150 * (index + 1));
                        
                        // 地區標籤翻譯
                        let regionName = "";
                        if (bean.region === "africa") 
                            regionName = translations[currentLang]['african-region'];
                        else if (bean.region === "americas") 
                            regionName = translations[currentLang]['american-region'];
                        else if (bean.region === "asia") 
                            regionName = translations[currentLang]['asian-region'];
                        
                        // 處理法翻譯
                        let processingName = "";
                        if (bean.processing === "washed") 
                            processingName = translations[currentLang]['washed-process'];
                        else if (bean.processing === "natural") 
                            processingName = translations[currentLang]['natural-process'];
                        else if (bean.processing === "honey") 
                            processingName = translations[currentLang]['honey-process'];
                        else if (bean.processing === "anaerobic") 
                            processingName = translations[currentLang]['anaerobic-process'];
                        else 
                            processingName = bean.processing;
                        
                        // 烘焙程度翻譯
                        let roastName = "";
                        if (bean.roast === "light") 
                            roastName = translations[currentLang]['light-roast-level'];
                        else if (bean.roast === "medium-light") 
                            roastName = translations[currentLang]['medium-light-roast-level'];
                        else if (bean.roast === "medium") 
                            roastName = translations[currentLang]['medium-roast-level'];
                        else if (bean.roast === "medium-dark") 
                            roastName = translations[currentLang]['medium-dark-roast-level'];
                        else if (bean.roast === "dark") 
                            roastName = translations[currentLang]['dark-roast-level'];
                        else 
                            roastName = bean.roast;
                        
                        if (isProfessionalMode) {
                            // 專業模式顯示
                            beanElement.innerHTML = `
                                <h3>${bean.name}</h3>
                                <div class="professional-details">
                                    <div class="professional-row">
                                        <div class="professional-item">
                                            <strong>${translations[currentLang]['origin']}</strong> ${bean.origin} (${regionName})
                                        </div>
                                        <div class="professional-item">
                                            <strong>${translations[currentLang]['estate']}</strong> ${bean.estate || translations[currentLang]['unknown']}
                                        </div>
                                    </div>
                                    <div class="professional-row">
                                        <div class="professional-item">
                                            <strong>${translations[currentLang]['varieties']}</strong> ${bean.varieties || translations[currentLang]['unknown']}
                                        </div>
                                        <div class="professional-item">
                                            <strong>${translations[currentLang]['altitude-value']}</strong> ${bean.altitude || translations[currentLang]['unknown']} ${translations[currentLang]['meters']}
                                        </div>
                                    </div>
                                    <div class="professional-row">
                                        <div class="professional-item">
                                            <strong>${translations[currentLang]['processing']}</strong>
                                            <span class="processing-tag">${processingName}</span>
                                        </div>
                                        <div class="professional-item">
                                            <strong>${translations[currentLang]['roast']}</strong>
                                            <span class="processing-tag">${roastName}</span>
                                        </div>
                                    </div>
                                    ${bean.cupping_score ? `
                                    <div class="professional-row" style="margin-top: 8px;">
                                        <div class="professional-item">
                                            <strong>${translations[currentLang]['cupping-score']}</strong> ${bean.cupping_score}
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                                <p>${bean.description}</p>
                                <div class="flavor-profile">
                                    <span class="flavor-tag">${translations[currentLang]['acidity'].replace('：', '').replace(':', '')}: ${bean.acidity}/10</span>
                                    <span class="flavor-tag">${translations[currentLang]['body'].replace('：', '').replace(':', '')}: ${bean.body}/10</span>
                                    <span class="flavor-tag">${translations[currentLang]['sweetness'].replace('：', '').replace(':', '')}: ${bean.sweetness}/10</span>
                                    <span class="flavor-tag">${translations[currentLang]['bitterness'].replace('：', '').replace(':', '')}: ${bean.bitterness}/10</span>
                                </div>
                                <div class="flavor-profile">
                                    <span class="flavor-tag">${translations[currentLang]['fruity'].replace('：', '').replace(':', '')}: ${bean.fruity}/10</span>
                                    <span class="flavor-tag">${translations[currentLang]['nutty'].replace('：', '').replace(':', '')}: ${bean.nutty}/10</span>
                                    <span class="flavor-tag">${translations[currentLang]['chocolate'].replace('：', '').replace(':', '')}: ${bean.chocolate}/10</span>
                                    <span class="flavor-tag">${translations[currentLang]['floral'].replace('：', '').replace(':', '')}: ${bean.floral}/10</span>
                                </div>
                                <p class="brewing-tips"><strong>${translations[currentLang]['brewing-tips-title']}</strong> ${bean.brewingTips}</p>
                            `;
                        } else {
                            // 簡易模式顯示
                            beanElement.innerHTML = `
                                <h3>${bean.name} <span class="origin-badge">${regionName}</span></h3>
                                <div class="simple-view">
                                    <p>${bean.description}</p>
                                    
                                    <div class="simple-flavor">
                                        <div class="flavor-bar-container">
                                            <span class="flavor-name">${translations[currentLang]['acidity'].replace('：', '').replace(':', '')}</span>
                                            <div class="flavor-bar">
                                                <div class="flavor-fill" data-width="${bean.acidity * 10}%" style="width: 0"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="flavor-bar-container">
                                            <span class="flavor-name">${translations[currentLang]['body'].replace('：', '').replace(':', '')}</span>
                                            <div class="flavor-bar">
                                                <div class="flavor-fill" data-width="${bean.body * 10}%" style="width: 0"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="flavor-bar-container">
                                            <span class="flavor-name">${translations[currentLang]['sweetness'].replace('：', '').replace(':', '')}</span>
                                            <div class="flavor-bar">
                                                <div class="flavor-fill" data-width="${bean.sweetness * 10}%" style="width: 0"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="flavor-bar-container">
                                            <span class="flavor-name">${translations[currentLang]['bitterness'].replace('：', '').replace(':', '')}</span>
                                            <div class="flavor-bar">
                                                <div class="flavor-fill" data-width="${bean.bitterness * 10}%" style="width: 0"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <p class="brewing-tips"><strong>${translations[currentLang]['brewing-tips-title']}</strong> ${bean.brewingTips}</p>
                                </div>
                            `;
                        }
                        
                        recommendationsContainer.appendChild(beanElement);
                    });
                }
                
                // 隱藏載入指示器
                document.getElementById('loading-indicator').style.display = 'none';
                
                // 平滑滾動到結果
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }, 1000); // 模擬載入時間
        }
        
        // 搜尋按鈕點擊
        document.getElementById('search-button').addEventListener('click', function() {
            document.getElementById('results').classList.remove('show');
            
            try {
                // 根據當前語言獲取相應的咖啡豆數據庫
                const coffeeBeans = getCoffeeBeansData();
                
                // 隱藏錯誤消息（如果有）
                document.getElementById('error-message').style.display = 'none';
                
                // 生成推薦
                generateRecommendations(coffeeBeans);
            } catch (error) {
                // 顯示錯誤消息
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
                console.error('無法加載咖啡豆數據:', error);
            }
        });
        
        // 語言切換監聽器
        document.querySelectorAll('.language-switcher a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                setLanguage(this.getAttribute('data-lang'));
            });
        });
        
        // 響應窗口大小變化時更新選擇器寬度
        window.addEventListener('resize', updateSelectorWidth);
        
        // 初始化頁面
        window.addEventListener('load', function() {
            // 創建背景咖啡豆動畫
            createCoffeeBeans();
            
            // 設置初始語言
            const savedLang = safelyGetPreference('preferredLanguage', null);
            let browserLang = 'en';
            
            try {
                browserLang = navigator.language.startsWith('zh') ? 'zh' : 'en';
            } catch (e) {
                console.warn('Unable to detect browser language:', e);
            }
            
            setLanguage(savedLang || browserLang);
            
            // 初始化選擇器寬度和位置
            setTimeout(function() {
                // 初始化烘焙選擇器的寬度和位置
                const activeRoastButton = document.querySelector('.roast-btn.active');
                if (activeRoastButton) {
                    const roastButtons = document.querySelectorAll('.roast-btn');
                    const index = Array.from(roastButtons).indexOf(activeRoastButton);
                    const width = 100 / roastButtons.length;
                    const offset = index * width;
                    roastHighlight.style.width = `${width}%`;
                    roastHighlight.style.transform = `translateX(${offset}%)`;
                }
                
                // 初始化模式選擇器的寬度和位置
                updateSelectorWidth();
            }, 0);
        });
    </script>
    <!-- 100% privacy-first analytics -->
    <script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>
